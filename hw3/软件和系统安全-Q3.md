### 一、实验任务

#### 3、在notepad（32位64位均可）中，输入一段文字。然后使用调试器，在内存中修改这段文字。使得没有在界面操作notepad的修改文字的情况下。notepad中显示的文字变化。

- 程序只有运行起来，才会接受用户输入的数据，并为之分配一个随机的内存空间把用户输入的数据保存在该内存空间中   调试器：WINDUBUG OB
  提示，在调试器中定位控件缓存的内存地址，可以用搜索、逆向、消息截获分析、API截获分析等方法。

- 软件是数据和对数据的操作的集合。
  软件安全就是研究软件的操作的具体过程、数据的具体形式，然后想办法获得、修改、破坏或者实施隐藏。又分为攻和防两个方面。
  底层的软件，一次操作所能影响的数据少，操作的逻辑简单。
  越到高层，一次操作所能影响的数据越多，操作的逻辑越复杂。
  例如
  - 指令 -> C语言语句 -> 函数 -> 对象
    汇编 -> C -> C++ -> 各类脚本。
    所以，我们进行软件攻防也有两种基本的方法。
    hook 和 DKOM
    hook，挂钩，即找到程序中的原有代码，并修改其代码，增加、减少或者篡改原用功能。达到授权破解（keygen）、作弊（游戏外挂）、隐藏（隐蔽攻击痕迹防止被防御软件查杀）等目的。
    DKOM，直接内核对象操作。是一种典型的直接对程序内部数据的攻击。

#### 4、通过调试器监控计算器程序的运行，每当运行结果为666时，就改为999。

提示：找到运行结果在内存中保存的地址。监控 “=” 按键消息等。
- 抓住修改时间，现实时立即改，不能直接在程序中搜索修改“666”，不能直接通过修改数据，而是通过修改代码，textout函数调用，在textout函数的参数看看是不是“666”，将之改为“999”，修改textout函数·的指针-》函数在哪里（api调用与导入导出密切相关-》动态链接库-》定位函数地址-》下断点-》检查该函数是否被调用-》在被调用的时候篡改参数（ Windebug）【1.修改导入表更容易，IAT，导出表只在程序初始化的时候用一次，当程序已经初始化以后，导入表已经初始化，2.改代码，jump 地址计算清楚】）
  

## 二、实验过程

3.1在win10中打开运行起来notepad.exe,并在屏幕显示的界面输入一串字符串如`youarelovely`

3.2打开Windbg，选择`File->Attach a Process->notepad.exe

![](/hw3/images/image-20190313103621919.png)

3.3在其中查找在notepad.exe界面中显示的字符串在内存中的存放地址，即第一个内存位置

```bash
#查看所有堆
!heap -a
```

![](/hw3/images/image-20190313103649155.png)

```bash
#查找显示在notepad上的目标字符串在堆中的位置
s -u lc937e70000 L000ff000 "warmhome"
```

![](/hw3/images/image-20190313104036083.png)

```bah
#以Unicode编码形式显示在00000lc9`37e79950处字符串
du 00000lc9`37e79950
```

![](/hw3/images/image-20190313104616679.png)

3.4修改在在此处的数据为目标要显示在notepad上的字符串

```bash
# 修改在位置00000lc9`37e79950处显示的字符串
ezu 00000lc9`37e79950 "warmhome"
# 显示在位置000001bc`d95f4f80处显示的修改后的字符串的Unicode编码形式
du 00000lc9`37e79950
```

![](/hw3/images/image-20190313104825117.png)

3.5修改后继续运行notepad程序，成功看到notepad此时显示的字符串为在Windbg中通过指令修改后的目标字符串`Iamlovely`

```bash
# 继续运行notepad程序
g
```

![](/hw3/images/image-20190313104922566.png)

### 三、实验问题

- [ ] 当显示在notepad上要修改的字符串超过8个字符时如何做进一步修改？

#### 实验参考

####  [Day-Day-Up/软件与系统安全/3/
](https://github.com/jckling/Day-Day-Up/tree/sf/%E8%BD%AF%E4%BB%B6%E4%B8%8E%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8/3)
